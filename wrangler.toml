# Cloudflare Workers Configuration
name = "rest-shop-api"
main = "src/worker.js"
compatibility_date = "2024-01-01"

# Account details (will be overridden by secrets in CI/CD)
# account_id = "YOUR_ACCOUNT_ID"
# workers_dev = true

[env.production]
name = "rest-shop-api-production"
routes = [
  { pattern = "api.yourdomain.com/*", zone_name = "yourdomain.com" }
]

[env.staging]
name = "rest-shop-api-staging"

# Environment variables (non-sensitive)
[vars]
NODE_ENV = "production"
PORT = "3001"

# Secrets (set via wrangler secret put or in Cloudflare dashboard)
# - JWT_KEY
# - MONGODB_URI or MONGO_ATLAS_PW
# - ALLOWED_ORIGINS

# Service bindings
# Note: Replace YOUR_KV_NAMESPACE_ID with your actual KV namespace ID from Cloudflare dashboard
# or set via: wrangler kv:namespace create "CACHE"
[[kv_namespaces]]
binding = "CACHE"
id = "YOUR_KV_NAMESPACE_ID"  # Replace with: wrangler kv:namespace create "CACHE"
preview_id = "YOUR_PREVIEW_KV_NAMESPACE_ID"  # Replace with: wrangler kv:namespace create "CACHE" --preview

# Durable Objects (for MongoDB connection pooling)
[[durable_objects.bindings]]
name = "DB_CONNECTION"
class_name = "DatabaseConnection"

# Build configuration
[build]
command = "npm install && npm run build"
watch_dirs = ["src"]

# Compatibility flags
[compatibility_flags]
nodejs_compat = true
