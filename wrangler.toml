# Cloudflare Workers Configuration
name = "rest-shop-api"
main = "src/worker.js"
compatibility_date = "2024-01-01"

# Account details (will be overridden by secrets in CI/CD)
workers_dev = true

[env.production]
name = "rest-shop-api-production"
routes = [
  { pattern = "api.yourdomain.com/*", zone_name = "yourdomain.com" }
]

[env.staging]
name = "rest-shop-api-staging"

# Environment variables (non-sensitive)
[vars]
NODE_ENV = "production"
PORT = "3001"

# Add non-sensitive URLs here
ALLOWED_ORIGINS = "https://your-frontend.pages.dev,http://localhost:3000,http://localhost:3001"
FRONTEND_URL = "https://your-frontend.pages.dev"

# Secrets (set via wrangler secret put or in Cloudflare dashboard)
# - JWT_KEY
# - MONGODB_URI or MONGO_ATLAS_PW
# - ALLOWED_ORIGINS

# Service bindings
[[kv_namespaces]]
binding = "CACHE"
id = "2b52b610274c4a078262f796b01bb7ec"  # Replace with: wrangler kv:namespace create "CACHE"
#preview_id = "YOUR_PREVIEW_KV_NAMESPACE_ID"  # Replace with: wrangler kv:namespace create "CACHE" --preview

# Durable Objects (for MongoDB connection pooling)
[[durable_objects.bindings]]
name = "DB_CONNECTION"
class_name = "DatabaseConnection"

# Build configuration
[build]
command = "npm install && npm run build"
watch_dirs = ["src"]

# Compatibility flags
[compatibility_flags]
nodejs_compat = true
