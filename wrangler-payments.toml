# Cloudflare Workers Configuration - Payment Service
name = "rest-shop-payments"
main = "src/payment-worker.js"

# Payment Service Worker
# This worker handles all payment-related operations (Stripe, PayPal, M-Pesa)
# Part of microservices architecture to keep bundle sizes under 1MB

# Compatibility flags
compatibility_date = "2026-01-20"
compatibility_flags = [ "nodejs_compat" ]

find_additional_modules = true

# Account details (will be overridden by secrets in CI/CD)
workers_dev = true

# Environment variables (non-sensitive)
[vars]
NODE_ENV = "production"
PORT = "3001"
FRONTEND_URL = "https://rest-shop.pages.dev"

# Service bindings
[[kv_namespaces]]
binding = "CACHE"
id = "2b52b610274c4a078262f796b01bb7ec"

# Durable Objects (for MongoDB connection pooling)
[[durable_objects.bindings]]
name = "PAYMENT_DB_CONNECTION"
class_name = "PaymentDatabaseConnection"

# Build configuration
[build]
command = "npm run build"

# Migrations
[[migrations]]
tag = "v1"
new_sqlite_classes = ["PaymentDatabaseConnection"]
