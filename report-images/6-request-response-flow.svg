<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 850 650">
  <defs>
    <style>
      .title { font: bold 20px sans-serif; fill: #2c3e50; }
      .client { fill: #3498db; stroke: #2980b9; stroke-width: 2; }
      .middleware { fill: #9b59b6; stroke: #8e44ad; stroke-width: 2; }
      .controller { fill: #27ae60; stroke: #229954; stroke-width: 2; }
      .model { fill: #f39c12; stroke: #d68910; stroke-width: 2; }
      .database { fill: #e74c3c; stroke: #c0392b; stroke-width: 2; }
      .text { font: 13px sans-serif; fill: white; text-anchor: middle; }
      .smalltext { font: 11px sans-serif; fill: white; }
      .label { font: 12px sans-serif; fill: #2c3e50; text-anchor: middle; }
      .arrow { stroke: #34495e; stroke-width: 2.5; fill: none; marker-end: url(#arrowhead); }
      .arrow-back { stroke: #7f8c8d; stroke-width: 2; fill: none; marker-end: url(#arrowhead-back); stroke-dasharray: 5,3; }
      .step { font: bold 11px sans-serif; fill: #e74c3c; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#34495e" />
    </marker>
    <marker id="arrowhead-back" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#7f8c8d" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="425" y="30" class="title">Request-Response Flow Diagram</text>
  
  <!-- Vertical Lanes -->
  <text x="100" y="70" class="label" style="font-weight: bold;">Client</text>
  <text x="250" y="70" class="label" style="font-weight: bold;">Security</text>
  <text x="400" y="70" class="label" style="font-weight: bold;">Controller</text>
  <text x="550" y="70" class="label" style="font-weight: bold;">Model</text>
  <text x="700" y="70" class="label" style="font-weight: bold;">Database</text>
  
  <!-- Client -->
  <rect x="50" y="90" width="100" height="60" class="client" rx="5"/>
  <text x="100" y="117" class="text">HTTP Client</text>
  <text x="100" y="135" class="smalltext" style="fill: white; text-anchor: middle;">(Browser/App)</text>
  
  <!-- Flow Steps -->
  <!-- Step 1: Request -->
  <text x="25" y="185" class="step">1</text>
  <path d="M 150 120 L 200 120" class="arrow"/>
  <text x="175" y="113" class="label" style="font-size: 11px;">POST /orders</text>
  <text x="175" y="140" class="label" style="font-size: 10px;">Authorization: Bearer token</text>
  <text x="175" y="152" class="label" style="font-size: 10px;">{productId, quantity}</text>
  
  <!-- Security Layer -->
  <rect x="200" y="90" width="100" height="60" class="middleware" rx="5"/>
  <text x="250" y="117" class="text">Middleware</text>
  <text x="250" y="135" class="smalltext" style="fill: white; text-anchor: middle;">Stack</text>
  
  <!-- Step 2: Security Checks -->
  <text x="25" y="220" class="step">2</text>
  <rect x="200" y="170" width="100" height="95" fill="#ecf0f1" stroke="#9b59b6" stroke-width="2" rx="3"/>
  <text x="250" y="190" class="label" style="font-weight: bold; font-size: 12px;">Security Checks</text>
  <text x="210" y="208" class="label" style="font-size: 10px;">✓ CORS validation</text>
  <text x="210" y="223" class="label" style="font-size: 10px;">✓ Rate limiting</text>
  <text x="210" y="238" class="label" style="font-size: 10px;">✓ Helmet headers</text>
  <text x="210" y="253" class="label" style="font-size: 10px;">✓ Input sanitization</text>
  
  <!-- Step 3: Authentication -->
  <text x="25" y="305" class="step">3</text>
  <rect x="200" y="280" width="100" height="65" fill="#ecf0f1" stroke="#9b59b6" stroke-width="2" rx="3"/>
  <text x="250" y="300" class="label" style="font-weight: bold; font-size: 12px;">Auth Check</text>
  <text x="210" y="318" class="label" style="font-size: 10px;">✓ Verify JWT</text>
  <text x="210" y="333" class="label" style="font-size: 10px;">✓ Extract userId</text>
  
  <!-- Step 4: Validation -->
  <text x="25" y="380" class="step">4</text>
  <rect x="200" y="360" width="100" height="50" fill="#ecf0f1" stroke="#9b59b6" stroke-width="2" rx="3"/>
  <text x="250" y="380" class="label" style="font-weight: bold; font-size: 12px;">Validation</text>
  <text x="210" y="398" class="label" style="font-size: 10px;">✓ Schema validation</text>
  
  <!-- Step 5: To Controller -->
  <text x="25" y="438" class="step">5</text>
  <path d="M 300 390 L 350 390" class="arrow"/>
  <text x="325" y="385" class="label" style="font-size: 11px;">Pass to controller</text>
  
  <!-- Controller -->
  <rect x="350" y="360" width="100" height="60" class="controller" rx="5"/>
  <text x="400" y="387" class="text">Order</text>
  <text x="400" y="405" class="text">Controller</text>
  
  <!-- Step 6: Business Logic -->
  <text x="25" y="465" class="step">6</text>
  <rect x="350" y="435" width="100" height="65" fill="#ecf0f1" stroke="#27ae60" stroke-width="2" rx="3"/>
  <text x="400" y="455" class="label" style="font-weight: bold; font-size: 11px;">Business Logic</text>
  <text x="360" y="473" class="label" style="font-size: 10px;">• Validate product</text>
  <text x="360" y="488" class="label" style="font-size: 10px;">• Calculate price</text>
  
  <!-- Step 7: To Model -->
  <text x="25" y="530" class="step">7</text>
  <path d="M 450 467 L 500 467" class="arrow"/>
  <text x="475" y="462" class="label" style="font-size: 11px;">Create order</text>
  
  <!-- Model -->
  <rect x="500" y="437" width="100" height="60" class="model" rx="5"/>
  <text x="550" y="464" class="text">Order</text>
  <text x="550" y="482" class="text">Model</text>
  
  <!-- Step 8: To Database -->
  <text x="25" y="565" class="step">8</text>
  <path d="M 600 467 L 650 467" class="arrow"/>
  <text x="625" y="462" class="label" style="font-size: 11px;">Insert document</text>
  
  <!-- Database -->
  <rect x="650" y="437" width="100" height="60" class="database" rx="5"/>
  <text x="700" y="464" class="text">MongoDB</text>
  <text x="700" y="482" class="text">Atlas</text>
  
  <!-- Return Flow -->
  <!-- Step 9: DB Response -->
  <text x="825" y="520" class="step">9</text>
  <path d="M 650 497 L 600 517" class="arrow-back"/>
  <text x="625" y="520" class="label" style="font-size: 11px;">Saved order</text>
  
  <!-- Step 10: Model Response -->
  <text x="825" y="555" class="step">10</text>
  <path d="M 500 517 L 450 537" class="arrow-back"/>
  <text x="475" y="540" class="label" style="font-size: 11px;">Order object</text>
  
  <!-- Step 11: Controller Response -->
  <text x="825" y="590" class="step">11</text>
  <rect x="350" y="550" width="100" height="50" fill="#ecf0f1" stroke="#27ae60" stroke-width="2" rx="3"/>
  <text x="400" y="570" class="label" style="font-weight: bold; font-size: 11px;">Format Response</text>
  <text x="360" y="588" class="label" style="font-size: 10px;">Build JSON response</text>
  
  <path d="M 350 575 L 300 575" class="arrow-back"/>
  <text x="325" y="570" class="label" style="font-size: 11px;">JSON + Status 201</text>
  
  <!-- Step 12: Final Response -->
  <text x="25" y="605" class="step">12</text>
  <path d="M 200 575 L 150 575" class="arrow-back"/>
  <text x="175" y="570" class="label" style="font-size: 11px;">HTTP Response</text>
  
  <!-- Response Details -->
  <rect x="50" y="160" width="100" height="100" fill="#ecf0f1" stroke="#3498db" stroke-width="2" rx="3"/>
  <text x="100" y="180" class="label" style="font-weight: bold; font-size: 11px;">Response</text>
  <text x="60" y="198" class="label" style="font-size: 10px;">201 Created</text>
  <text x="60" y="213" class="label" style="font-size: 10px;">{</text>
  <text x="65" y="228" class="label" style="font-size: 10px;">  orderId: "...",</text>
  <text x="65" y="243" class="label" style="font-size: 10px;">  message: "..."</text>
  <text x="60" y="255" class="label" style="font-size: 10px;">}</text>
  
  <!-- Legend -->
  <rect x="50" y="615" width="750" height="25" fill="#2c3e50" rx="3"/>
  <text x="425" y="633" class="text" style="font-size: 12px;">Complete Request-Response Cycle for POST /orders endpoint</text>
</svg>
