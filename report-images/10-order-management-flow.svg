<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 650">
  <defs>
    <style>
      .title { font: bold 20px sans-serif; fill: #2c3e50; }
      .client { fill: #3498db; stroke: #2980b9; stroke-width: 2; }
      .api { fill: #27ae60; stroke: #229954; stroke-width: 2; }
      .db { fill: #f39c12; stroke: #d68910; stroke-width: 2; }
      .text { font: 13px sans-serif; fill: white; text-anchor: middle; }
      .smalltext { font: 11px sans-serif; fill: white; }
      .label { font: 11px sans-serif; fill: #2c3e50; text-anchor: middle; }
      .arrow { stroke: #34495e; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .arrow-back { stroke: #7f8c8d; stroke-width: 2; fill: none; marker-end: url(#arrowhead-back); stroke-dasharray: 5,3; }
      .step { font: bold 11px sans-serif; fill: #e74c3c; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#34495e" />
    </marker>
    <marker id="arrowhead-back" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#7f8c8d" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="400" y="30" class="title">Order Management Flow</text>
  
  <!-- Actors -->
  <rect x="50" y="70" width="120" height="50" class="client" rx="5"/>
  <text x="110" y="100" class="text">User/Client</text>
  
  <rect x="340" y="70" width="120" height="50" class="api" rx="5"/>
  <text x="400" y="95" class="text">API Server</text>
  <text x="400" y="110" class="smalltext" style="fill: white; text-anchor: middle;">Order Controller</text>
  
  <rect x="630" y="70" width="120" height="50" class="db" rx="5"/>
  <text x="690" y="100" class="text">Database</text>
  
  <!-- Flow Steps -->
  
  <!-- Step 1: Create Order -->
  <text x="20" y="160" class="step">1</text>
  <rect x="50" y="145" width="120" height="40" fill="#ecf0f1" stroke="#3498db" stroke-width="2" rx="3"/>
  <text x="110" y="162" class="label" style="font-weight: bold;">Create Order</text>
  <text x="110" y="177" class="label" style="font-size: 10px;">Click "Order" button</text>
  
  <path d="M 170 165 L 340 165" class="arrow"/>
  <text x="255" y="160" class="label">POST /orders</text>
  <text x="255" y="184" class="label" style="font-size: 10px;">{productId, quantity}</text>
  
  <!-- Step 2: Authenticate -->
  <text x="20" y="225" class="step">2</text>
  <rect x="340" y="210" width="120" height="40" fill="#ecf0f1" stroke="#27ae60" stroke-width="2" rx="3"/>
  <text x="400" y="227" class="label" style="font-weight: bold;">Verify JWT</text>
  <text x="400" y="242" class="label" style="font-size: 10px;">Extract userId</text>
  
  <!-- Step 3: Validate Product -->
  <text x="20" y="280" class="step">3</text>
  <path d="M 460 230 L 630 230" class="arrow"/>
  <text x="545" y="225" class="label">Check product exists</text>
  
  <path d="M 630 240 L 460 240" class="arrow-back"/>
  <text x="545" y="255" class="label">Product details</text>
  
  <!-- Step 4: Validate -->
  <text x="20" y="310" class="step">4</text>
  <rect x="340" y="265" width="120" height="55" fill="#ecf0f1" stroke="#27ae60" stroke-width="2" rx="3"/>
  <text x="400" y="282" class="label" style="font-weight: bold;">Validate Order</text>
  <text x="400" y="297" class="label" style="font-size: 10px;">• Product exists?</text>
  <text x="400" y="310" class="label" style="font-size: 10px;">• Quantity valid?</text>
  
  <!-- Step 5: Calculate -->
  <text x="20" y="360" class="step">5</text>
  <rect x="340" y="335" width="120" height="40" fill="#ecf0f1" stroke="#27ae60" stroke-width="2" rx="3"/>
  <text x="400" y="352" class="label" style="font-weight: bold;">Calculate Total</text>
  <text x="400" y="367" class="label" style="font-size: 10px;">price * quantity</text>
  
  <!-- Step 6: Save Order -->
  <text x="20" y="410" class="step">6</text>
  <path d="M 460 355 L 630 355" class="arrow"/>
  <text x="545" y="350" class="label">Save order document</text>
  
  <path d="M 630 365 L 460 365" class="arrow-back"/>
  <text x="545" y="383" class="label">Order ID + details</text>
  
  <!-- Step 7: Response -->
  <text x="20" y="445" class="step">7</text>
  <path d="M 340 390 L 170 390" class="arrow-back"/>
  <text x="255" y="385" class="label">201 Created</text>
  <text x="255" y="408" class="label" style="font-size: 10px;">{orderId, message, request}</text>
  
  <!-- Step 8: Display -->
  <text x="20" y="475" class="step">8</text>
  <rect x="50" y="420" width="120" height="40" fill="#ecf0f1" stroke="#3498db" stroke-width="2" rx="3"/>
  <text x="110" y="437" class="label" style="font-weight: bold;">Show Success</text>
  <text x="110" y="452" class="label" style="font-size: 10px;">Order confirmation</text>
  
  <!-- Get Orders Flow -->
  <text x="400" y="495" class="label" style="font-weight: bold; font-size: 14px;">─── Get All Orders ───</text>
  
  <!-- Step 9: Request Orders -->
  <text x="20" y="530" class="step">9</text>
  <path d="M 170 515 L 340 515" class="arrow"/>
  <text x="255" y="510" class="label">GET /orders</text>
  
  <!-- Step 10: Fetch from DB -->
  <text x="20" y="565" class="step">10</text>
  <path d="M 460 515 L 630 515" class="arrow"/>
  <text x="545" y="510" class="label">Find user's orders</text>
  
  <path d="M 630 525 L 460 525" class="arrow-back"/>
  <text x="545" y="543" class="label">Order array</text>
  
  <!-- Step 11: Return Orders -->
  <text x="20" y="595" class="step">11</text>
  <path d="M 340 540 L 170 540" class="arrow-back"/>
  <text x="255" y="535" class="label">200 OK</text>
  <text x="255" y="558" class="label" style="font-size: 10px;">{orders: [...], count}</text>
  
  <!-- Step 12: Display -->
  <text x="20" y="625" class="step">12</text>
  <rect x="50" y="570" width="120" height="40" fill="#ecf0f1" stroke="#3498db" stroke-width="2" rx="3"/>
  <text x="110" y="587" class="label" style="font-weight: bold;">Display Orders</text>
  <text x="110" y="602" class="label" style="font-size: 10px;">Show order list</text>
</svg>
