<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 700">
  <defs>
    <style>
      .title { font: bold 20px sans-serif; fill: #2c3e50; }
      .admin { fill: #e74c3c; stroke: #c0392b; stroke-width: 2; }
      .client { fill: #3498db; stroke: #2980b9; stroke-width: 2; }
      .api { fill: #27ae60; stroke: #229954; stroke-width: 2; }
      .storage { fill: #f39c12; stroke: #d68910; stroke-width: 2; }
      .db { fill: #9b59b6; stroke: #8e44ad; stroke-width: 2; }
      .text { font: 13px sans-serif; fill: white; text-anchor: middle; }
      .smalltext { font: 11px sans-serif; fill: white; }
      .label { font: 11px sans-serif; fill: #2c3e50; text-anchor: middle; }
      .arrow { stroke: #34495e; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .arrow-back { stroke: #7f8c8d; stroke-width: 2; fill: none; marker-end: url(#arrowhead-back); stroke-dasharray: 5,3; }
      .step { font: bold 11px sans-serif; fill: #e74c3c; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#34495e" />
    </marker>
    <marker id="arrowhead-back" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#7f8c8d" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="400" y="30" class="title">Product Management Flow</text>
  
  <!-- Create Product Flow -->
  <text x="400" y="60" class="label" style="font-weight: bold; font-size: 14px;">─── Create Product (Admin Only) ───</text>
  
  <!-- Actors -->
  <rect x="50" y="80" width="100" height="50" class="admin" rx="5"/>
  <text x="100" y="110" class="text">Admin User</text>
  
  <rect x="200" y="80" width="120" height="50" class="api" rx="5"/>
  <text x="260" y="105" class="text">API Server</text>
  <text x="260" y="120" class="smalltext" style="fill: white; text-anchor: middle;">Product Controller</text>
  
  <rect x="370" y="80" width="110" height="50" class="storage" rx="5"/>
  <text x="425" y="105" class="text">File Storage</text>
  <text x="425" y="120" class="smalltext" style="fill: white; text-anchor: middle;">Multer</text>
  
  <rect x="530" y="80" width="100" height="50" class="db" rx="5"/>
  <text x="580" y="110" class="text">Database</text>
  
  <!-- Create Flow -->
  <!-- Step 1 -->
  <text x="20" y="175" class="step">1</text>
  <rect x="50" y="160" width="100" height="50" fill="#ecf0f1" stroke="#e74c3c" stroke-width="2" rx="3"/>
  <text x="100" y="180" class="label" style="font-weight: bold;">Upload Form</text>
  <text x="100" y="195" class="label" style="font-size: 10px;">Name, Price,</text>
  <text x="100" y="207" class="label" style="font-size: 10px;">Image file</text>
  
  <!-- Step 2 -->
  <text x="20" y="245" class="step">2</text>
  <path d="M 150 185 L 200 185" class="arrow"/>
  <text x="175" y="180" class="label">POST /products</text>
  <text x="175" y="206" class="label" style="font-size: 10px;">multipart/form-data</text>
  
  <!-- Step 3: Auth Check -->
  <text x="20" y="280" class="step">3</text>
  <rect x="200" y="230" width="120" height="50" fill="#ecf0f1" stroke="#27ae60" stroke-width="2" rx="3"/>
  <text x="260" y="250" class="label" style="font-weight: bold;">Check Auth</text>
  <text x="260" y="265" class="label" style="font-size: 10px;">Verify JWT</text>
  <text x="260" y="277" class="label" style="font-size: 10px;">Check role: admin</text>
  
  <!-- Step 4: Upload Image -->
  <text x="20" y="325" class="step">4</text>
  <path d="M 320 255 L 370 255" class="arrow"/>
  <text x="345" y="250" class="label">Upload image</text>
  
  <rect x="370" y="230" width="110" height="50" fill="#ecf0f1" stroke="#f39c12" stroke-width="2" rx="3"/>
  <text x="425" y="250" class="label" style="font-weight: bold;">Process File</text>
  <text x="425" y="265" class="label" style="font-size: 10px;">Save to uploads/</text>
  <text x="425" y="277" class="label" style="font-size: 10px;">Generate path</text>
  
  <path d="M 370 265 L 320 265" class="arrow-back"/>
  <text x="345" y="283" class="label">File path</text>
  
  <!-- Step 5: Validate -->
  <text x="20" y="335" class="step">5</text>
  <rect x="200" y="300" width="120" height="50" fill="#ecf0f1" stroke="#27ae60" stroke-width="2" rx="3"/>
  <text x="260" y="320" class="label" style="font-weight: bold;">Validate Data</text>
  <text x="260" y="335" class="label" style="font-size: 10px;">Name, price &gt; 0</text>
  <text x="260" y="347" class="label" style="font-size: 10px;">Image required</text>
  
  <!-- Step 6: Save Product -->
  <text x="20" y="395" class="step">6</text>
  <path d="M 320 325 L 530 325" class="arrow"/>
  <text x="425" y="320" class="label">Save product doc</text>
  
  <path d="M 530 335 L 320 335" class="arrow-back"/>
  <text x="425" y="353" class="label">Product ID</text>
  
  <!-- Step 7: Response -->
  <text x="20" y="430" class="step">7</text>
  <path d="M 200 360 L 150 380" class="arrow-back"/>
  <text x="175" y="375" class="label">201 Created</text>
  <text x="175" y="395" class="label" style="font-size: 10px;">{product details}</text>
  
  <!-- Get Products Flow -->
  <text x="400" y="435" class="label" style="font-weight: bold; font-size: 14px;">─── Get All Products (Public) ───</text>
  
  <!-- Public user -->
  <rect x="650" y="80" width="100" height="50" class="client" rx="5"/>
  <text x="700" y="105" class="text">Any User</text>
  <text x="700" y="120" class="smalltext" style="fill: white; text-anchor: middle;">(Public)</text>
  
  <!-- Step 8 -->
  <text x="675" y="175" class="step">8</text>
  <path d="M 650 105 L 320 185" class="arrow"/>
  <text x="485" y="145" class="label">GET /products</text>
  
  <!-- Step 9: Fetch -->
  <text x="675" y="210" class="step">9</text>
  <rect x="200" y="455" width="120" height="40" fill="#ecf0f1" stroke="#27ae60" stroke-width="2" rx="3"/>
  <text x="260" y="475" class="label" style="font-weight: bold;">Fetch Products</text>
  <text x="260" y="490" class="label" style="font-size: 10px;">Query database</text>
  
  <path d="M 320 475 L 530 475" class="arrow"/>
  <text x="425" y="470" class="label">Find all products</text>
  
  <path d="M 530 485 L 320 485" class="arrow-back"/>
  <text x="425" y="503" class="label">Product array</text>
  
  <!-- Step 10: Return -->
  <text x="675" y="530" class="step">10</text>
  <path d="M 200 495 L 150 515" class="arrow-back"/>
  <text x="175" y="510" class="label">200 OK</text>
  <text x="175" y="528" class="label" style="font-size: 10px;">{products: [...]}</text>
  
  <!-- Update/Delete Flow -->
  <text x="400" y="565" class="label" style="font-weight: bold; font-size: 14px;">─── Update/Delete Product (Admin Only) ───</text>
  
  <!-- Step 11 -->
  <text x="20" y="605" class="step">11</text>
  <rect x="50" y="590" width="100" height="50" fill="#ecf0f1" stroke="#e74c3c" stroke-width="2" rx="3"/>
  <text x="100" y="610" class="label" style="font-weight: bold;">Admin Action</text>
  <text x="100" y="625" class="label" style="font-size: 10px;">PATCH or</text>
  <text x="100" y="637" class="label" style="font-size: 10px;">DELETE /:id</text>
  
  <!-- Step 12 -->
  <text x="20" y="675" class="step">12</text>
  <path d="M 150 615 L 200 615" class="arrow"/>
  <text x="175" y="610" class="label">Request + JWT</text>
  
  <rect x="200" y="590" width="120" height="50" fill="#ecf0f1" stroke="#27ae60" stroke-width="2" rx="3"/>
  <text x="260" y="610" class="label" style="font-weight: bold;">Verify Admin</text>
  <text x="260" y="625" class="label" style="font-size: 10px;">Check JWT role</text>
  <text x="260" y="637" class="label" style="font-size: 10px;">Authorize action</text>
  
  <!-- Step 13 -->
  <text x="345" y="625" class="step">13</text>
  <path d="M 320 615 L 530 615" class="arrow"/>
  <text x="425" y="610" class="label">Update/Delete doc</text>
  
  <path d="M 530 625 L 320 625" class="arrow-back"/>
  <text x="425" y="643" class="label">Success/Error</text>
  
  <!-- Step 14 -->
  <text x="20" y="695" class="step">14</text>
  <path d="M 200 640 L 150 660" class="arrow-back"/>
  <text x="175" y="655" class="label">200 OK or 404</text>
</svg>
