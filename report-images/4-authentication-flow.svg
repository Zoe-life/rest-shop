<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 700">
  <defs>
    <style>
      .title { font: bold 20px sans-serif; fill: #2c3e50; }
      .subtitle { font: bold 16px sans-serif; fill: #34495e; }
      .client { fill: #3498db; stroke: #2980b9; stroke-width: 2; }
      .server { fill: #27ae60; stroke: #229954; stroke-width: 2; }
      .oauth { fill: #e74c3c; stroke: #c0392b; stroke-width: 2; }
      .db { fill: #f39c12; stroke: #d68910; stroke-width: 2; }
      .text { font: 13px sans-serif; fill: white; text-anchor: middle; }
      .label { font: 11px sans-serif; fill: #2c3e50; }
      .arrow { stroke: #7f8c8d; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .arrow-back { stroke: #95a5a6; stroke-width: 2; fill: none; marker-end: url(#arrowhead-back); stroke-dasharray: 5,5; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#7f8c8d" />
    </marker>
    <marker id="arrowhead-back" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#95a5a6" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="450" y="30" class="title">Authentication Flow Diagram</text>
  
  <!-- JWT Authentication Flow -->
  <text x="220" y="65" class="subtitle">JWT Authentication (Local)</text>
  
  <!-- Actors -->
  <rect x="50" y="85" width="100" height="50" class="client" rx="5"/>
  <text x="100" y="115" class="text">Client</text>
  
  <rect x="210" y="85" width="100" height="50" class="server" rx="5"/>
  <text x="260" y="115" class="text">API Server</text>
  
  <rect x="370" y="85" width="100" height="50" class="db" rx="5"/>
  <text x="420" y="115" class="text">Database</text>
  
  <!-- Flow Steps -->
  <!-- Step 1 -->
  <path d="M 150 110 L 210 110" class="arrow"/>
  <text x="180" y="105" class="label">1. POST /login</text>
  <text x="180" y="125" class="label" style="font-size: 10px;">{email, password}</text>
  
  <!-- Step 2 -->
  <path d="M 310 110 L 370 110" class="arrow"/>
  <text x="340" y="105" class="label">2. Query user</text>
  
  <!-- Step 3 -->
  <path d="M 370 120 L 310 120" class="arrow-back"/>
  <text x="340" y="140" class="label">3. User data</text>
  
  <!-- Step 4 -->
  <rect x="210" y="155" width="100" height="40" fill="#ecf0f1" stroke="#95a5a6" stroke-width="1" rx="3"/>
  <text x="260" y="172" class="label" style="font-weight: bold;">4. Verify Password</text>
  <text x="260" y="187" class="label" style="font-size: 10px;">bcrypt.compare()</text>
  
  <!-- Step 5 -->
  <rect x="210" y="205" width="100" height="40" fill="#ecf0f1" stroke="#95a5a6" stroke-width="1" rx="3"/>
  <text x="260" y="222" class="label" style="font-weight: bold;">5. Generate JWT</text>
  <text x="260" y="237" class="label" style="font-size: 10px;">1 hour expiry</text>
  
  <!-- Step 6 -->
  <path d="M 210 225 L 150 225" class="arrow-back"/>
  <text x="180" y="220" class="label">6. Return Token</text>
  <text x="180" y="243" class="label" style="font-size: 10px;">{token, message}</text>
  
  <!-- OAuth 2.0 Flow -->
  <text x="650" y="65" class="subtitle">OAuth 2.0 Flow</text>
  
  <!-- OAuth Actors -->
  <rect x="510" y="85" width="100" height="50" class="client" rx="5"/>
  <text x="560" y="115" class="text">Client</text>
  
  <rect x="640" y="85" width="100" height="50" class="server" rx="5"/>
  <text x="690" y="115" class="text">API Server</text>
  
  <rect x="770" y="85" width="100" height="50" class="oauth" rx="5"/>
  <text x="820" y="110" class="text">OAuth</text>
  <text x="820" y="125" class="text" style="font-size: 11px;">Provider</text>
  
  <!-- OAuth Steps -->
  <!-- Step 1 -->
  <path d="M 610 110 L 640 110" class="arrow"/>
  <text x="625" y="105" class="label">1. /auth/google</text>
  
  <!-- Step 2 -->
  <path d="M 740 110 L 770 110" class="arrow"/>
  <text x="755" y="105" class="label">2. Redirect</text>
  
  <!-- Step 3 -->
  <rect x="770" y="145" width="100" height="40" fill="#ecf0f1" stroke="#95a5a6" stroke-width="1" rx="3"/>
  <text x="820" y="162" class="label" style="font-weight: bold;">3. User Login</text>
  <text x="820" y="177" class="label" style="font-size: 10px;">at Provider</text>
  
  <!-- Step 4 -->
  <path d="M 770 165 L 740 165" class="arrow-back"/>
  <text x="755" y="160" class="label">4. Auth Code</text>
  
  <!-- Step 5 -->
  <path d="M 740 175 L 770 175" class="arrow"/>
  <text x="755" y="193" class="label">5. Exchange</text>
  <text x="755" y="205" class="label" style="font-size: 10px;">Code for Token</text>
  
  <!-- Step 6 -->
  <path d="M 770 185 L 740 185" class="arrow-back"/>
  <text x="755" y="220" class="label">6. Access Token</text>
  
  <!-- Step 7 -->
  <path d="M 740 200 L 770 200" class="arrow"/>
  <text x="755" y="238" class="label">7. Get Profile</text>
  
  <!-- Step 8 -->
  <path d="M 770 210 L 740 210" class="arrow-back"/>
  <text x="755" y="255" class="label">8. User Data</text>
  
  <!-- Step 9 -->
  <rect x="640" y="225" width="100" height="40" fill="#ecf0f1" stroke="#95a5a6" stroke-width="1" rx="3"/>
  <text x="690" y="242" class="label" style="font-weight: bold;">9. Create/Update</text>
  <text x="690" y="257" class="label" style="font-size: 10px;">User in DB</text>
  
  <!-- Step 10 -->
  <rect x="640" y="275" width="100" height="40" fill="#ecf0f1" stroke="#95a5a6" stroke-width="1" rx="3"/>
  <text x="690" y="292" class="label" style="font-weight: bold;">10. Generate JWT</text>
  <text x="690" y="307" class="label" style="font-size: 10px;">1 hour expiry</text>
  
  <!-- Step 11 -->
  <path d="M 640 295 L 610 295" class="arrow-back"/>
  <text x="625" y="290" class="label">11. Redirect</text>
  <text x="625" y="310" class="label" style="font-size: 10px;">with JWT</text>
  
  <!-- Protected Request Flow -->
  <text x="450" y="360" class="subtitle">Protected Request Flow</text>
  
  <!-- Protected Flow Actors -->
  <rect x="150" y="380" width="100" height="50" class="client" rx="5"/>
  <text x="200" y="410" class="text">Client</text>
  
  <rect x="340" y="380" width="120" height="50" class="server" rx="5"/>
  <text x="400" y="405" class="text">Middleware</text>
  <text x="400" y="420" class="text" style="font-size: 11px;">(check-auth)</text>
  
  <rect x="550" y="380" width="100" height="50" class="server" rx="5"/>
  <text x="600" y="410" class="text">Controller</text>
  
  <!-- Protected Steps -->
  <path d="M 250 405 L 340 405" class="arrow"/>
  <text x="295" y="400" class="label">1. Request + JWT</text>
  <text x="295" y="420" class="label" style="font-size: 10px;">Header: Bearer token</text>
  
  <rect x="340" y="445" width="120" height="55" fill="#ecf0f1" stroke="#95a5a6" stroke-width="1" rx="3"/>
  <text x="400" y="462" class="label" style="font-weight: bold;">2. Verify Token</text>
  <text x="400" y="477" class="label" style="font-size: 10px;">jwt.verify()</text>
  <text x="400" y="492" class="label" style="font-size: 10px;">Check expiration</text>
  
  <path d="M 460 405 L 550 405" class="arrow"/>
  <text x="505" y="400" class="label">3. Authorized</text>
  <text x="505" y="420" class="label" style="font-size: 10px;">req.userData</text>
  
  <rect x="550" y="445" width="100" height="40" fill="#ecf0f1" stroke="#95a5a6" stroke-width="1" rx="3"/>
  <text x="600" y="462" class="label" style="font-weight: bold;">4. Process</text>
  <text x="600" y="477" class="label" style="font-size: 10px;">Business Logic</text>
  
  <path d="M 550 465 L 460 465" class="arrow-back"/>
  <text x="505" y="460" class="label">5. Response</text>
  
  <path d="M 340 465 L 250 465" class="arrow-back"/>
  <text x="295" y="483" class="label">6. JSON Data</text>
  
  <!-- Security Features Box -->
  <rect x="50" y="540" width="800" height="135" fill="#ecf0f1" stroke="#34495e" stroke-width="2" rx="5"/>
  <text x="450" y="565" class="title" style="font-size: 16px;">Security Features</text>
  
  <g>
    <text x="70" y="595" class="label" style="font-weight: bold; font-size: 13px;">Password Security:</text>
    <text x="70" y="613" class="label">• Bcrypt hashing with salt rounds</text>
    <text x="70" y="628" class="label">• Strong password requirements (8+ chars, mixed case, numbers, symbols)</text>
    <text x="70" y="643" class="label">• Rate limiting: 5 login attempts per 15 minutes</text>
    <text x="70" y="658" class="label">• Account lockout after failed attempts</text>
  </g>
  
  <g>
    <text x="480" y="595" class="label" style="font-weight: bold; font-size: 13px;">Token Security:</text>
    <text x="480" y="613" class="label">• JWT with 1-hour expiration</text>
    <text x="480" y="628" class="label">• Signed with secure secret key</text>
    <text x="480" y="643" class="label">• User role embedded in token</text>
    <text x="480" y="658" class="label">• OAuth providers: Google, Microsoft, Apple</text>
  </g>
</svg>
